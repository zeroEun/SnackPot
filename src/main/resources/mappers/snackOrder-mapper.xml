<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="snackOrderMapper">

	<resultMap type="Orders" id="ordersResultSet">
		<id property="orderNo" column="ORDER_NO"/>
		<result property="comCode" column="COM_CODE"/>
		<result property="comName" column="COM_NAME"/>
		<result property="orderStatus" column="ORDER_STATUS"/>
		<result property="budget" column="BUDGET"/>
		<result property="totalPrice" column="TOTAL_PRICE"/>
		<result property="orderDeadline" column="ORDER_DEADLINE"/>
		<result property="orderDate" column="ORDER_DATE"/>
		<result property="releaseDate" column="RELEASE_DATE"/>
	</resultMap>
	
	<resultMap type="OrderDetail" id="orderDetailResultSet">
		<id property="orderDNo" column="ORDER_D_NO"/>
		<result property="orderNo" column="ORDER_NO"/>
		<result property="categoryNo" column="CATEGORY_NO"/>
		<result property="categoryName" column="CATEGORY"/>
		<result property="subCategoryNo" column="DETAIL_NO"/>
		<result property="subCategoryName" column="DETAIL"/>
		<result property="snackNo" column="SNACK_NO"/>
		<result property="snackName" column="SNACK_NAME"/>
		<result property="amount" column="AMOUNT"/>
		<result property="releasePrice" column="RELEASE_PRICE"/>
		<result property="stock" column="STOCK"/>
		<result property="imageName" column="CHANGE_NAME"/>
	</resultMap>

	<select id="selectOrder" parameterType="String" resultMap="ordersResultSet">
		SELECT A.ORDER_NO, A.COM_CODE, B.COM_NAME, A.ORDER_DEADLINE, A.BUDGET
		FROM ORDERS A
		LEFT JOIN COMPANY B ON (A.COM_CODE = B.COM_CODE)
		WHERE A.COM_CODE = #{comCode}
		AND ORDER_STATUS = 'N'
	</select>
	
	<select id="selectOrderDetail" parameterType="_int" resultMap="orderDetailResultSet">
		SELECT A.ORDER_D_NO, A.ORDER_NO, A.AMOUNT, A.SNACK_NO, B.SNACK_NAME, B.RELEASE_PRICE, B.CATEGORY_NO, D.CATEGORY,  B.DETAIL_NO, E.DETAIL,
			   B.STOCK, C.CHANGE_NAME
		FROM ORDER_DETAIL A
		JOIN SNACK B ON (A.SNACK_NO = B.SNACK_NO)
		LEFT JOIN SNACK_ATTACHMENT C ON (B.SNACK_NO = C.SNACK_NO)
		JOIN SNACK_CATEGORY D ON (B.CATEGORY_NO = D.CATEGORY_NO)
		JOIN SNACK_CATEGORY_DETAIL E ON (B.DETAIL_NO = E.DETAIL_NO)
		WHERE ORDER_NO = #{orderNo}
		ORDER BY B.CATEGORY_NO ASC, B.DETAIL_NO ASC, B.SNACK_NAME ASC
	</select>

	<select id="selectTotalPrice" parameterType="_int" resultType="_int">
		SELECT NVL(SUM(B.RELEASE_PRICE * A.AMOUNT), 0)
		FROM ORDER_DETAIL A
		JOIN SNACK B ON (A.SNACK_NO = B.SNACK_NO)
		WHERE A.ORDER_NO = #{orderNo} 
	</select>

</mapper>